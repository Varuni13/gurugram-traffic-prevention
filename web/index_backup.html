<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gurugram Flood + Traffic Dashboard</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <!-- Panel toggle button -->
  <button id="panel-toggle" class="panel-open" title="Toggle Panel">â˜°</button>

  <div id="control-panel">
    <div class="title">Dashboard</div>

    <!-- Search -->
    <div class="section-title">Search Location</div>
    <div class="row-inline">
      <input type="text" id="searchInput" placeholder="Enter a location" />
      <button id="searchButton" class="btn">Search</button>
    </div>

    <hr />

    <!-- Flood Time Slider -->
    <!-- =========================================
         SIMULATION SCENARIO PANEL (Enhanced)
         ========================================= -->
    <div
      style="background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%); border: 2px solid #c7d2fe; border-radius: 12px; padding: 14px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(79, 70, 229, 0.1);">
      <div style="font-weight: 700; color: #4338ca; margin-bottom: 10px; font-size: 15px; display: flex; align-items: center; gap: 6px;">
        <span style="font-size: 18px;">ğŸŒŸ</span>
        <span>Simulation Scenario</span>
      </div>
      <div style="font-size: 13px; color: #1e1b4b; line-height: 1.7; background: rgba(255,255,255,0.7); padding: 10px; border-radius: 6px;">
        <div style="margin-bottom: 4px;"><strong style="color: #1e40af;">ğŸŒŠ Flood:</strong> <span id="scenarioFloodTime" style="color: #0f172a; font-weight: 500;">--</span></div>
        <div id="trafficSyncInfo" style="color: #16a34a; font-weight: 500;">ğŸ“ <strong style="color: #166534;">Traffic:</strong> Synced to --:-- IST</div>
      </div>
      <div style="font-size: 10.5px; font-style: italic; color: #4338ca; margin-top: 10px; text-align: center; border-top: 1px solid #c7d2fe; padding-top: 8px;">
        "Simulating flood impact during real traffic conditions"
      </div>
    </div>

    <!-- Flood Time (Slider) - Beautified -->
    <div class="section-title" style="display: flex; align-items: center; justify-content: space-between;">
      <span>â° Time Selection</span>
      <button id="reloadFloodButton" class="btn" style="padding: 3px 10px; font-size: 10px; background: #6366f1; color: white; border: none; border-radius: 4px;">â†»</button>
    </div>
    
    <!-- Data availability indicator -->
    <div id="dataAvailabilityInfo" style="background: #ecfdf5; border-left: 3px solid #10b981; padding: 8px 10px; margin-bottom: 8px; border-radius: 4px; font-size: 11px; color: #065f46; display: none;">
      <strong>ğŸ“Š Active Window:</strong> <span id="activeTimeWindow">--</span>
    </div>
    
    <div id="floodTimelineStatus" class="hint" style="font-size: 11px; color: #64748b; margin-bottom: 6px;">Flood timeline: loadingâ€¦</div>

    <input id="floodTimeSlider" type="range" min="0" max="0" step="1" value="0" style="width: 100%; height: 8px; border-radius: 4px; cursor: pointer;" />
    <div class="row-inline" style="justify-content: space-between; margin-top: 8px;">
      <div class="hint" id="floodTimeLabel" style="font-size: 12px; color: #475569; font-weight: 500;">Index 0</div>
      <div class="hint" id="floodTimeRange" style="font-size: 10px; color: #94a3b8;"></div>
    </div>

    <hr />

    <!-- Route Comparison Table -->
    <div id="routeComparisonPanel" style="display: none; margin-top: 20px;">
      <div class="section-title">ğŸ“Š Route Comparison</div>
      <table style="width: 100%; font-size: 12px; border-collapse: collapse; margin-top: 5px;">
        <thead>
          <tr style="border-bottom: 2px solid #e2e8f0; text-align: left; color: #64748b;">
            <th style="padding: 4px;">Type</th>
            <th style="padding: 4px;">Dist</th>
            <th style="padding: 4px;">ETA</th>
            <th style="padding: 4px;">Status</th>
          </tr>
        </thead>
        <tbody id="routeComparisonBody">
          <!-- Rows will be injected by JS -->
        </tbody>
      </table>
    </div>

    <hr />

    <!-- Snapshot (Hidden/Minimized for cleaner look) -->
    <!-- <div class="section-title">Traffic Snapshot</div> -->
    <div id="snapshotStatus" class="hint" style="display:none;">Traffic snapshot: not loaded yet</div>
    <button id="refreshTrafficButton" class="btn btn-primary" style="margin-top: 10px;">ğŸ”„ Refresh Live Traffic</button>

    <hr />

    <!-- Layers -->
    <div class="section-title">Layers</div>
    <label class="row">
      <input type="checkbox" id="toggleTrafficPoints" checked />
      <span>Traffic Snapshot Points</span>
    </label>

    <label class="row">
      <input type="checkbox" id="toggleTraffic" />
      <span>Live Traffic Tiles (needs API key)</span>
    </label>

    <label class="row">
      <input type="checkbox" id="toggleFlood" checked />
      <span>Flood Layer</span>
    </label>

    <label class="row">
      <input type="checkbox" id="toggleRoadNetwork" checked />
      <span>Road Network Overlay</span>
    </label>

    <hr />

    <!-- Legend -->
    <div class="section-title">Legend</div>
    <div class="legend-item">
      <span class="swatch" style="background: #3b82f6;"></span>
      <span>Flooded roads</span>
    </div>
    <div class="legend-item">
      <span class="swatch"
        style="background: repeating-linear-gradient(90deg, #16a34a, #16a34a 4px, transparent 4px, transparent 8px);"></span>
      <span>Route uses shallow flood (â‰¤0.3m)</span>
    </div>
    <div class="legend-item">
      <span class="swatch swatch-traffic"></span>
      <span>Traffic speed (green â†’ red)</span>
    </div>

    <hr />

    <!-- Route Comparison Checkboxes -->
    <div class="section-title">Route Comparison</div>
    <div class="route-checkboxes">
      <label class="row route-option">
        <input type="checkbox" id="routeShortest" checked />
        <span class="route-swatch" style="background:#8b5cf6"></span>
        <span>Shortest (distance)</span>
      </label>
      <label class="row route-option">
        <input type="checkbox" id="routeTraffic" />
        <span class="route-swatch" style="background:#8B4513"></span>
        <span>Traffic-avoiding (time)</span>
      </label>
      <label class="row route-option">
        <input type="checkbox" id="routeFlood" />
        <span class="route-swatch" style="background:#006400"></span>
        <span>Flood-avoiding</span>
      </label>
      <label class="row route-option">
        <input type="checkbox" id="routeSmart" />
        <span class="route-swatch" style="background:#000000"></span>
        <span>Smart (avoid both)</span>
      </label>
    </div>
    <div class="hint">Check routes to compare. Routes calculate when origin + destination set.</div>

    <hr />

    <!-- Quick Routes -->
    <div class="section-title">Quick Routes</div>
    <div class="quick-route-controls">
      <div class="quick-route-row">
        <label>From:</label>
        <select id="quickRouteFrom" class="quick-select">
          <option value="">-- Select Origin --</option>
          <option value="iffco">IFFCO Chowk</option>
          <option value="mgroad">MG Road</option>
          <option value="cyberhub">Cyber Hub</option>
          <option value="golfcourse">Golf Course Rd</option>
          <option value="sohna">Sohna Road</option>
          <option value="nh48">NH-48 (Ambience)</option>
          <option value="rajiv">Rajiv Chowk</option>
          <option value="huda">Huda City Centre</option>
          <option value="sector56">Sector 56</option>
          <option value="manesar">Manesar Rd</option>
        </select>
      </div>
      <div class="quick-route-row">
        <label>To:</label>
        <select id="quickRouteTo" class="quick-select">
          <option value="">-- Select Destination --</option>
          <option value="iffco">IFFCO Chowk</option>
          <option value="mgroad">MG Road</option>
          <option value="cyberhub">Cyber Hub</option>
          <option value="golfcourse">Golf Course Rd</option>
          <option value="sohna">Sohna Road</option>
          <option value="nh48">NH-48 (Ambience)</option>
          <option value="rajiv">Rajiv Chowk</option>
          <option value="huda">Huda City Centre</option>
          <option value="sector56">Sector 56</option>
          <option value="manesar">Manesar Rd</option>
        </select>
      </div>
      <button id="calculateQuickRouteBtn" class="btn btn-primary">ğŸ“ Calculate Quick Route</button>
      <div style="display:flex; gap:6px; margin-top:6px;">
        <button id="clearQuickRoutesBtn" class="clear-btn" style="flex:1;">ğŸ—‘ï¸ Clear</button>
        <button id="zoomToRouteBtn" class="zoom-btn" style="flex:1;">ğŸ” Zoom to Route</button>
      </div>
    </div>

    <div class="divider-text">â€” OR click on map â€”</div>

    <hr />

    <!-- Custom Routing -->
    <div class="section-title">Route Planning (Custom)</div>

    <div class="route-controls">
      <div class="route-row">
        <button id="setOriginBtn" class="route-btn origin-btn">ğŸ“ Set Origin</button>
        <span id="originLabel" class="coord-label">Click 'Set Origin'</span>
      </div>

      <div class="route-row">
        <button id="setDestBtn" class="route-btn dest-btn">ğŸ¯ Set Destination</button>
        <span id="destLabel" class="coord-label">Click 'Set Destination'</span>
      </div>

      <button id="clearRoutesBtn" class="clear-btn">ğŸ—‘ï¸ Clear Routes</button>
      <div id="routeStatus" class="route-status"></div>
    </div>
  </div>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="./app.js"></script>
</body>

</html>