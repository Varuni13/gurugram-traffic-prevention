<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gurugram Flood + Traffic Dashboard</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="./style.css" />
</head>

<body>
    <!-- Panel toggle button -->
    <button id="panel-toggle" class="panel-open" title="Toggle Panel">‚ò∞</button>

    <div id="control-panel">
        <div class="title">Dashboard</div>

        <!-- Search -->
        <div class="section-title">Search Location</div>
        <div class="row-inline">
            <input type="input" id="searchInput" placeholder="Enter a location" />
            <button id="searchButton" class="btn">Search</button>
        </div>

        <hr />

        <!-- Simulation Scenario (Always Visible) -->
        <div
            style="background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%); border: 2px solid #c7d2fe; border-radius: 12px; padding: 14px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(79, 70, 229, 0.1);">
            <div
                style="font-weight: 700; color: #4338ca; margin-bottom: 10px; font-size: 15px; display: flex; align-items: center; gap: 6px;">
                <span style="font-size: 18px;">üåü</span>
                <span>Simulation Scenario</span>
            </div>
            <div
                style="font-size: 13px; color: #1e1b4b; line-height: 1.7; background: rgba(255,255,255,0.7); padding: 10px; border-radius: 6px;">
                <div style="margin-bottom: 4px;"><strong style="color: #1e40af;">üåä Flood:</strong> <span
                        id="scenarioFloodTime" style="color: #0f172a; font-weight: 500;">--</span></div>
                <div id="trafficSyncInfo" style="color: #16a34a; font-weight: 500;">üìç <strong
                        style="color: #166534;">Traffic:</strong> Synced to --:-- IST</div>
            </div>
            <div
                style="font-size: 10.5px; font-style: italic; color: #4338ca; margin-top: 10px; text-align: center; border-top: 1px solid #c7d2fe; padding-top: 8px;">
                "Simulating flood impact during real traffic conditions"
            </div>
        </div>

        <!-- ACCORDION SECTION 1: Time Selection -->
        <div class="accordion-section">
            <div class="accordion-header" onclick="toggleAccordion('timeSection')">
                <span class="accordion-icon">‚è∞</span>
                <span class="accordion-title">Time Selection</span>
                <span class="accordion-chevron" id="timeSection-chevron">‚ñº</span>
            </div>
            <div class="accordion-content" id="timeSection">
                <!-- Data availability indicator -->
                <div id="dataAvailabilityInfo"
                    style="background: #ecfdf5; border-left: 3px solid #10b981; padding: 8px 10px; margin-bottom: 8px; border-radius: 4px; font-size: 11px; color: #065f46; display: none;">
                    <strong>üìä Active Window:</strong> <span id="activeTimeWindow">--</span>
                </div>

                <div id="floodTimelineStatus" class="hint" style="font-size: 11px; color: #64748b; margin-bottom: 6px;">
                    Flood timeline: loading‚Ä¶</div>

                <input id="floodTimeSlider" type="range" min="0" max="0" step="1" value="0"
                    style="width: 100%; height: 8px; border-radius: 4px; cursor: pointer;" />
                <div class="row-inline" style="justify-content: space-between; margin-top: 8px;">
                    <div class="hint" id="floodTimeLabel" style="font-size: 12px; color: #475569; font-weight: 500;">
                        Index 0</div>
                    <div class="hint" id="floodTimeRange" style="font-size: 10px; color: #94a3b8;"></div>
                </div>

                <button id="reloadFloodButton" class="btn"
                    style="width: 100%; margin-top: 8px; padding: 6px; font-size: 11px; background: #6366f1; color: white; border: none;">‚Üª
                    Reload Timeline</button>
            </div>
        </div>

        <!-- ACCORDION SECTION 2: Map Layers -->
        <div class="accordion-section">
            <div class="accordion-header" onclick="toggleAccordion('layersSection')">
                <span class="accordion-icon">üëÅÔ∏è</span>
                <span class="accordion-title">Map Layers</span>
                <span class="accordion-chevron" id="layersSection-chevron">‚ñº</span>
            </div>
            <div class="accordion-content" id="layersSection">
                <label class="row">
                    <input type="checkbox" id="toggleTrafficPoints" checked />
                    <span>Traffic Snapshot Points</span>
                </label>

                <label class="row">
                    <input type="checkbox" id="toggleTraffic" />
                    <span>Live Traffic Tiles (needs API key)</span>
                </label>

                <label class="row">
                    <input type="checkbox" id="toggleFlood" checked />
                    <span>Flood Layer</span>
                </label>

                <label class="row">
                    <input type="checkbox" id="toggleRoadNetwork" checked />
                    <span>Road Network Overlay</span>
                </label>

                <button id="refreshTrafficButton" class="btn btn-primary" style="margin-top: 10px;">üîÑ Refresh Live
                    Traffic</button>
            </div>
        </div>

        <!-- ACCORDION SECTION 3: Route Options -->
        <div class="accordion-section">
            <div class="accordion-header" onclick="toggleAccordion('routeOptionsSection')">
                <span class="accordion-icon">üõ£Ô∏è</span>
                <span class="accordion-title">Route Options</span>
                <span class="accordion-chevron" id="routeOptionsSection-chevron">‚ñº</span>
            </div>
            <div class="accordion-content" id="routeOptionsSection">
                <div class="route-checkboxes">
                    <label class="row route-option">
                        <input type="checkbox" id="routeShortest" checked />
                        <span class="route-swatch" style="background:#8b5cf6"></span>
                        <span>Shortest (distance)</span>
                    </label>
                    <label class="row route-option">
                        <input type="checkbox" id="routeTraffic" />
                        <span class="route-swatch" style="background:#8B4513"></span>
                        <span>Fastest (time)</span>
                    </label>
                    <label class="row route-option">
                        <input type="checkbox" id="routeFlood" />
                        <span class="route-swatch" style="background:#006400"></span>
                        <span>Flood-avoiding</span>
                    </label>
                    <label class="row route-option">
                        <input type="checkbox" id="routeSmart" />
                        <span class="route-swatch" style="background:#000000"></span>
                        <span>Smart (avoid both)</span>
                    </label>
                </div>
                <div class="hint" style="margin-top: 8px;">Check routes to compare. Routes calculate when origin +
                    destination set.</div>

                <!-- Route Comparison Table (inside options) -->
                <div id="routeComparisonPanel"
                    style="display: none; margin-top: 16px; padding-top: 12px; border-top: 1px solid #e2e8f0;">
                    <div style="font-weight: 600; margin-bottom: 6px; font-size: 12px;">üìä Route Comparison</div>
                    <table style="width: 100%; font-size: 12px; border-collapse: collapse;">
                        <thead>
                            <tr style="border-bottom: 2px solid #e2e8f0; text-align: left; color: #64748b;">
                                <th style="padding: 4px;">Type</th>
                                <th style="padding: 4px;">Dist</th>
                                <th style="padding: 4px;">ETA</th>
                                <th style="padding: 4px;">Status</th>
                            </tr>
                        </thead>
                        <tbody id="routeComparisonBody">
                            <!-- Rows will be injected by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ACCORDION SECTION 4: Route Planning -->
        <div class="accordion-section">
            <div class="accordion-header" onclick="toggleAccordion('routePlanningSection')">
                <span class="accordion-icon">üìå</span>
                <span class="accordion-title">Route Planning</span>
                <span class="accordion-chevron" id="routePlanningSection-chevron">‚ñº</span>
            </div>
            <div class="accordion-content" id="routePlanningSection">
                <!-- Quick Routes -->
                <div style="font-weight: 600; margin-bottom: 6px; font-size: 12px;">Quick Routes</div>
                <div class="quick-route-controls">
                    <div class="quick-route-row">
                        <label>From:</label>
                        <select id="quickRouteFrom" class="quick-select">
                            <option value="">-- Select Origin --</option>
                            <option value="iffco">IFFCO Chowk</option>
                            <option value="mgroad">MG Road</option>
                            <option value="cyberhub">Cyber Hub</option>
                            <option value="golfcourse">Golf Course Rd</option>
                            <option value="sohna">Sohna Road</option>
                            <option value="nh48">NH-48 (Ambience)</option>
                            <option value="rajiv">Rajiv Chowk</option>
                            <option value="huda">Huda City Centre</option>
                            <option value="sector56">Sector 56</option>
                            <option value="manesar">Manesar Rd</option>
                        </select>
                    </div>
                    <div class="quick-route-row">
                        <label>To:</label>
                        <select id="quickRouteTo" class="quick-select">
                            <option value="">-- Select Destination --</option>
                            <option value="iffco">IFFCO Chowk</option>
                            <option value="mgroad">MG Road</option>
                            <option value="cyberhub">Cyber Hub</option>
                            <option value="golfcourse">Golf Course Rd</option>
                            <option value="sohna">Sohna Road</option>
                            <option value="nh48">NH-48 (Ambience)</option>
                            <option value="rajiv">Rajiv Chowk</option>
                            <option value="huda">Huda City Centre</option>
                            <option value="sector56">Sector 56</option>
                            <option value="manesar">Manesar Rd</option>
                        </select>
                    </div>
                    <button id="calculateQuickRouteBtn" class="btn btn-primary">üìç Calculate Quick Route</button>
                    <div style="display:flex; gap:6px; margin-top:6px;">
                        <button id="clearQuickRoutesBtn" class="clear-btn" style="flex:1;">üóëÔ∏è Clear</button>
                        <button id="zoomToRouteBtn" class="zoom-btn" style="flex:1;">üîç Zoom to Route</button>
                    </div>
                </div>

                <div class="divider-text">‚Äî OR click on map ‚Äî</div>

                <!-- Custom Routing -->
                <div style="font-weight: 600; margin-bottom: 6px; margin-top: 12px; font-size: 12px;">Custom (Click on
                    Map)</div>
                <div class="route-controls">
                    <div class="route-row">
                        <button id="setOriginBtn" class="route-btn origin-btn">üìç Set Origin</button>
                        <span id="originLabel" class="coord-label">Click 'Set Origin'</span>
                    </div>

                    <div class="route-row">
                        <button id="setDestBtn" class="route-btn dest-btn">üéØ Set Destination</button>
                        <span id="destLabel" class="coord-label">Click 'Set Destination'</span>
                    </div>

                    <button id="clearRoutesBtn" class="clear-btn">üóëÔ∏è Clear Routes</button>
                    <div id="routeStatus" class="route-status"></div>
                </div>
            </div>
        </div>

        <!-- ACCORDION SECTION 5: Legend (Optional) -->
        <div class="accordion-section">
            <div class="accordion-header" onclick="toggleAccordion('legendSection')">
                <span class="accordion-icon">üìñ</span>
                <span class="accordion-title">Legend</span>
                <span class="accordion-chevron" id="legendSection-chevron">‚ñ∂</span>
            </div>
            <div class="accordion-content collapsed" id="legendSection">
                <div class="legend-item">
                    <span class="swatch" style="background: #3b82f6;"></span>
                    <span>Flooded roads</span>
                </div>
                <div class="legend-item">
                    <span class="swatch"
                        style="background: repeating-linear-gradient(90deg, #16a34a, #16a34a 4px, transparent 4px, transparent 8px);"></span>
                    <span>Route uses shallow flood (‚â§0.3m)</span>
                </div>
                <div class="legend-item">
                    <span class="swatch swatch-traffic"></span>
                    <span>Traffic speed (green ‚Üí red)</span>
                </div>
            </div>
        </div>

    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="./app.js"></script>
</body>

</html>